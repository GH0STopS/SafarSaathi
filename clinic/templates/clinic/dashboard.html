{% extends 'base.html' %}
{% block title %}Clinic Dashboard - Safar-Saathi{% endblock %}

{% block content %}

<style>
  .card-soft {
    background: #f8fafc;
  }
  .card-header-soft {
    background: #f1f5f9;
    font-weight: 600;
  }
  .action-btn {
    padding: 1.25rem;
    font-weight: 600;
  }
</style>

<!-- Header -->
<div class="card mb-3">
  <div class="card-body py-3 d-flex justify-content-between align-items-center">
    <div>
      <h4 class="mb-1">
        <i class="fas fa-hospital me-2 text-danger"></i>
        {{ clinic.name }}
      </h4>
      <small class="text-muted">
        <i class="fas fa-map-marker-alt me-1"></i>
        {{ clinic.location }}
      </small>
    </div>
  </div>
</div>

<!-- Transfers + Treatments -->
<div class="row g-3">

  <!-- Transfer Requests -->
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header card-header-soft py-2">
        <i class="fas fa-exchange-alt me-1"></i> Transfer Requests
      </div>
      <div class="card-body py-2">
        {% for request in transfer_requests %}
        <div class="border rounded p-2 mb-2 bg-light">
          <small class="fw-semibold">
            {{ request.patient.user.get_full_name|default:request.patient.user.username }}
          </small>
          <div class="small text-muted">
            From {{ request.from_clinic.name }}
          </div>

          <span class="badge bg-{% if request.status == 'approved' %}success{% elif request.status == 'pending' %}warning{% else %}danger{% endif %}">
            {{ request.status|title }}
          </span>

          {% if request.status == 'pending' %}
          <div class="mt-2">
            <a href="{% url 'clinic:approve_transfer' request.id %}" class="btn btn-success btn-sm">Approve</a>
            <a href="{% url 'clinic:reject_transfer' request.id %}" class="btn btn-danger btn-sm">Reject</a>
          </div>
          {% endif %}
        </div>
        {% empty %}
        <p class="text-muted small mb-0">No transfer requests.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Recent Treatments -->
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header card-header-soft py-2">
        <i class="fas fa-notes-medical me-1"></i> Recent Treatments
      </div>
      <div class="card-body py-2">
        {% for record in treatment_records %}
        <div class="border rounded p-2 mb-2 bg-light">
          <small class="fw-semibold">
            {{ record.patient.user.get_full_name|default:record.patient.user.username }}
          </small>
          <div class="small text-muted">
            {{ record.details|truncatechars:80 }}
          </div>
        </div>
        {% empty %}
        <p class="text-muted small mb-0">No recent treatments.</p>
        {% endfor %}
      </div>
    </div>
  </div>

</div>

<!-- Primary Actions -->
<div class="row g-2 mt-3">
  <div class="col-md-3 col-6">
    <a href="{% url 'clinic:manage_appointments' %}" class="btn btn-success w-100 action-btn">
      <i class="fas fa-calendar-alt d-block mb-1"></i>
      Appointments
    </a>
  </div>
  <div class="col-md-3 col-6">
    <a href="{% url 'clinic:manage_counselling_sessions' %}" class="btn btn-info w-100 action-btn">
      <i class="fas fa-user-friends d-block mb-1"></i>
      Counselling
    </a>
  </div>
  <div class="col-md-3 col-6">
    <a href="{% url 'clinic:external_consultations' %}" class="btn btn-warning w-100 action-btn">
      <i class="fas fa-globe d-block mb-1"></i>
      External
    </a>
  </div>
  <div class="col-md-3 col-6">
    <a href="{% url 'clinic:telemedicine_management' %}" class="btn btn-primary w-100 action-btn">
      <i class="fas fa-video d-block mb-1"></i>
      Telemedicine
    </a>
  </div>
</div>

<!-- Secondary Actions -->
<div class="row g-2 mt-2">
  <div class="col-md-3 col-6">
    <a href="{% url 'clinic:manage_prescriptions' %}" class="btn btn-outline-info w-100">
      Prescriptions
    </a>
  </div>
  <div class="col-md-3 col-6">
    <a href="{% url 'clinic:medical_data_requests' %}" class="btn btn-outline-warning w-100">
      Data Requests
    </a>
  </div>
  <div class="col-md-3 col-6">
    <a href="{% url 'clinic:clinic_transfer_request' %}" class="btn btn-outline-primary w-100">
      Transfers
    </a>
  </div>
  <div class="col-md-3 col-6">
    <a href="{% url 'clinic:add_treatment_record' %}" class="btn btn-outline-secondary w-100">
      Add Treatment
    </a>
  </div>
</div>

<!-- Emergency -->
<div class="row g-2 mt-3">
  <div class="col-12">
    <a href="{% url 'emergency:emergency_alerts' %}" class="btn btn-outline-danger w-100 py-3">
      <i class="fas fa-exclamation-triangle me-2"></i>
      Emergency Alerts
    </a>
  </div>
</div>

{% endblock %}
